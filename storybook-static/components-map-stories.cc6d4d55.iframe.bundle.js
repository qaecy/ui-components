(self.webpackChunkui_components=self.webpackChunkui_components||[]).push([[606],{"./projects/cue-ui/src/lib/components/map.component.ts.css?ngResource!=!./node_modules/@ngtools/webpack/src/loaders/inline-resource.js?data=CiAgICAgIEBpbXBvcnQgdXJsKCdtYXBib3gtZ2wvZGlzdC9tYXBib3gtZ2wuY3NzJyk7CiAgICAgICNtYXAgewogICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICB0b3A6IDA7CiAgICAgICAgbGVmdDogMDsKICAgICAgICByaWdodDogMDsKICAgICAgICBib3R0b206IDA7CiAgICAgICAgYm9yZGVyLXJhZGl1czogaW5oZXJpdDsgLyogSW5oZXJpdHMgZnJvbSBob3N0ICovCiAgICAgIH0KICAgICAgOmhvc3QgewogICAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgICBvdmVyZmxvdzogaGlkZGVuOyAvKiBFbnN1cmVzIGJvcmRlci1yYWRpdXMgY2xpcHMgY2hpbGQgZWxlbWVudHMgKi8KICAgICAgfQogICAg!./projects/cue-ui/src/lib/components/map.component.ts":(module,__unused_webpack_exports,__webpack_require__)=>{var ___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/noSourceMaps.js"),___CSS_LOADER_API_IMPORT___=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_AT_RULE_IMPORT_0___=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[5].rules[0].oneOf[1].use[0]!./node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[5].rules[0].oneOf[1].use[1]!./node_modules/mapbox-gl/dist/mapbox-gl.css"),___CSS_LOADER_EXPORT___=___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_NO_SOURCEMAP_IMPORT___);___CSS_LOADER_EXPORT___.i(___CSS_LOADER_AT_RULE_IMPORT_0___),___CSS_LOADER_EXPORT___.push([module.id,"\n      #map {\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        border-radius: inherit; /* Inherits from host */\n      }\n      :host {\n        display: block;\n        position: relative;\n        overflow: hidden; /* Ensures border-radius clips child elements */\n      }\n    ",""]),module.exports=___CSS_LOADER_EXPORT___.toString()},"./projects/cue-ui/src/lib/components/map.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Card:()=>Card,Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>map_stories});var dist=__webpack_require__("./node_modules/@storybook/angular/dist/index.mjs"),asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),tslib_es6=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),map_component=__webpack_require__("./projects/cue-ui/src/lib/components/map.component.ts.css?ngResource!=!./node_modules/@ngtools/webpack/src/loaders/inline-resource.js?data=CiAgICAgIEBpbXBvcnQgdXJsKCdtYXBib3gtZ2wvZGlzdC9tYXBib3gtZ2wuY3NzJyk7CiAgICAgICNtYXAgewogICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICB0b3A6IDA7CiAgICAgICAgbGVmdDogMDsKICAgICAgICByaWdodDogMDsKICAgICAgICBib3R0b206IDA7CiAgICAgICAgYm9yZGVyLXJhZGl1czogaW5oZXJpdDsgLyogSW5oZXJpdHMgZnJvbSBob3N0ICovCiAgICAgIH0KICAgICAgOmhvc3QgewogICAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgICBvdmVyZmxvdzogaGlkZGVuOyAvKiBFbnN1cmVzIGJvcmRlci1yYWRpdXMgY2xpcHMgY2hpbGQgZWxlbWVudHMgKi8KICAgICAgfQogICAg!./projects/cue-ui/src/lib/components/map.component.ts"),map_component_default=__webpack_require__.n(map_component),core=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs"),common_module_CBrzkrmd=__webpack_require__("./node_modules/@angular/common/fesm2022/common_module-CBrzkrmd.mjs"),mapbox_gl=__webpack_require__("./node_modules/mapbox-gl/dist/mapbox-gl.js"),mapbox_gl_default=__webpack_require__.n(mapbox_gl),resized_directive=__webpack_require__("./projects/cue-ui/src/lib/directives/resized.directive.ts");let DarkModeDirective=class DarkModeDirective{destroyRef=(0,core.inject)(core.DestroyRef);_isDarkMode=(0,core.signal)(this.hasDarkClass());isDarkMode=(0,core.computed)((()=>this._isDarkMode()));darkModeChange=new core.EventEmitter;constructor(){const observer=new MutationObserver((mutations=>{mutations.forEach((mutation=>{if("attributes"===mutation.type&&"class"===mutation.attributeName){const newValue=this.hasDarkClass();newValue!==this._isDarkMode()&&this._isDarkMode.set(newValue)}}))}));observer.observe(document.body,{attributes:!0,attributeFilter:["class"]}),this.destroyRef.onDestroy((()=>observer.disconnect())),(0,core.effect)((()=>{console.log(`Dark mode changed to: ${this._isDarkMode()}`),this.darkModeChange.emit(this._isDarkMode())}))}hasDarkClass(){return document.body.classList.contains("dark")}toggleDarkMode(){document.body.classList.toggle("dark")}static ctorParameters=()=>[];static propDecorators={darkModeChange:[{type:core.Output}]}};DarkModeDirective=(0,tslib_es6.Cg)([(0,core.Directive)({selector:"[cueDarkMode]",standalone:!0,exportAs:"darkModeDetector"})],DarkModeDirective);let MapComponent=class MapComponent{mapboxToken=core.input.required();center=(0,core.input)([8.5,47.4]);zoom=(0,core.input)(2);featureCollection=(0,core.input)(void 0);cluster=!0;zoomToFit=!0;_height=(0,core.signal)("300px");_width=(0,core.signal)("400px");borderRadius=(0,core.input)("0");mapReady=new core.EventEmitter;clickedMap=new core.EventEmitter;pannedMap=new core.EventEmitter;panningMap=new core.EventEmitter;clickedFeature=new core.EventEmitter;hoveredFeature=new core.EventEmitter;polygonArea=new core.EventEmitter;polygonWKT=new core.EventEmitter;set mapContainer(content){content&&(this._mapContainer=content.nativeElement,void 0!==this._mapContainer&&this._init(this._mapContainer))}get hostBorderRadius(){return this.borderRadius()}_darkMode=(0,core.signal)(this._getSystemColorPreference());_styleId=(0,core.computed)((()=>this._darkMode()?"madsholten/clwjh4xeu00q601pnczm07jq6":"madsholten/clwjh6ug900q701pn6eor8p51"));_map;_mapContainer;_sourceIds=[];_mapReadyPromiseResolve;_mapReady=new Promise((resolve=>{this._mapReadyPromiseResolve=resolve}));_sources={};_sourceLayers={};_emittedReady=!1;_firstThemeReceived=!1;_attachedListeners=[];_hoveredFeature=(0,core.signal)(void 0);get hostHeight(){return this._height()}get hostWidth(){return this._width()}onCenterChange=(0,core.effect)((()=>{this._map?.flyTo({center:this.center(),essential:!0})}));onZoomChange=(0,core.effect)((()=>{this._map?.flyTo({center:this.center(),zoom:this.zoom(),essential:!0})}));onStyleChange=(0,core.effect)((()=>{console.log(this._styleId()),this._firstThemeReceived?(console.log("toggled dark mode"),void 0!==this._map&&this._updateStyle()):this._firstThemeReceived=!0}));onFeatureCollectionChange=(0,core.effect)((()=>{console.log(this.featureCollection());const featureCollection=this.featureCollection();if(void 0===featureCollection)return;const layer={id:"geojson-layer",type:"circle",source:"geojson",paint:{"circle-radius":4,"circle-stroke-width":2,"circle-color":"rgba(255,0,0,0.5)","circle-stroke-color":"white"}};this.loadGeoJSON("geojson",featureCollection,layer)}));get sources(){return this._sources}get map(){return this._map}ngOnDestroy(){this._map?.remove(),void 0!==this._mapContainer&&(this._mapContainer.innerHTML=""),console.log("DESTROYED")}loadGeoJSON(_x,_x2,_x3){var _this=this;return(0,asyncToGenerator.A)((function*(id,geoJSON,layer,cluster=_this.cluster,zoomToFit=_this.zoomToFit){yield _this._mapReady,_this.addSource(id,{type:"geojson",data:geoJSON,cluster},layer),zoomToFit&&_this.fitGeoJSONBBOX(geoJSON)})).apply(this,arguments)}fitGeoJSONBBOX(_x4){var _this2=this;return(0,asyncToGenerator.A)((function*(geoJSON,padding=.5){const bbox=geoJSON.bbox;void 0!==bbox&&(yield _this2._mapReady,_this2._map?.fitBounds([[bbox[0]-padding,bbox[1]-padding],[bbox[2]+padding,bbox[3]+padding]]))})).apply(this,arguments)}addSource(_x5,_x6,_x7){var _this3=this;return(0,asyncToGenerator.A)((function*(id,source,layer,layerClickable=!0){if(_this3._sources[id]=source,yield _this3._mapReady,void 0===_this3._map)return;_this3._deleteSourceIfExists(id),_this3._sourceIds.push(id);const existing=_this3._map?.getSource(id);void 0!==existing&&_this3._map?.removeSource(id),_this3._map?.addSource(id,source),void 0!==layer&&_this3.addSourceLayer(id,layer,layerClickable)})).apply(this,arguments)}addSourceLayer(sourceId,layer,clickable=!0){this._sourceLayers[sourceId]={layer,clickable},this._map?.addLayer(layer),clickable&&this._setLayerEvents()}setDarkMode(darkMode){this._darkMode.set(darkMode)}zoomToCoordinate(coordinate){const currentZoom=this._map?.getZoom();if(!currentZoom)return;const newZoom=currentZoom+1;console.log("zoomto"),this._map?.flyTo({center:coordinate,zoom:newZoom})}getImage(){const mapCanvas=this._map?.getCanvas();if(void 0!==mapCanvas)return console.log(mapCanvas),mapCanvas.toDataURL("image/png")}onParentResize(){this._map?.resize()}_deleteSourceIfExists(id){const src=this._map?.getSource(id);void 0!==src&&(this._map?.removeLayer(`${id}-layer`),this._map?.removeSource(id))}_init(container){void 0!==this._mapContainer&&(this._mapContainer.innerHTML=""),mapbox_gl_default().accessToken=this.mapboxToken(),this._map=new mapbox_gl.Map({container,style:this._getMapStyleURL(),center:this.center(),zoom:this.zoom()}),this._initEventListeners(this._map)}_initEventListeners(map){map.on("click",(e=>{void 0===this._hoveredFeature()&&this.clickedMap.emit(e)})),map.on("drag",(e=>{void 0===this._hoveredFeature()&&this.panningMap.emit(e)})),map.on("dragend",(e=>{void 0===this._hoveredFeature()&&this.pannedMap.emit(e)})),map.on("load",(()=>{this._emittedReady||(console.log("READY"),this._mapReadyPromiseResolve(),this.mapReady.emit(),this._emittedReady=!0)}))}_getMapStyleURL(){return`mapbox://styles/${this._styleId()}`}_updateStyle(){if(void 0===this._map)return;const zoom=this._map.getZoom(),center=this._map.getCenter();void 0!==this._mapContainer&&this._init(this._mapContainer),setTimeout((()=>{this._reAppendLayers(),this._map?.flyTo({center,zoom})}),500)}_reAppendLayers(){Object.keys(this._sources).forEach((id=>{this._deleteSourceIfExists(id),this._map?.addSource(id,this._sources[id]),this._map?.addLayer(this._sourceLayers[id].layer)})),this._setLayerEvents()}_setLayerEvents(){Object.keys(this._sourceLayers).forEach((id=>{const layerData=this._sourceLayers[id],layer=layerData.layer;layerData.clickable&&!this._attachedListeners.includes(id)&&(this._map?.on("click",layer.id,(e=>{if(void 0===e.features)return;const props=e.features[0].properties;props&&!props.cluster&&this.clickedFeature.emit({feature:e.features[0],event:e.originalEvent})})),this._map?.on("mouseenter",layer.id,(e=>{const canvas=this._map?.getCanvas();if(void 0!==canvas&&(canvas.style.cursor="pointer"),void 0===e.features)return;const props=e.features[0].properties;props&&!props.cluster&&(this.hoveredFeature.emit({feature:e.features[0],event:e.originalEvent}),this._hoveredFeature.set(e.features[0]))})),this._map?.on("mouseleave",layer.id,(e=>{const canvas=this._map?.getCanvas();void 0!==canvas&&(canvas.style.cursor=""),this.hoveredFeature.emit(void 0),this._hoveredFeature.set(void 0)})),this._attachedListeners.push(id)),this._map?.on("click",layer.id,(e=>{if(void 0===e.features)return;const props=e.features[0].properties;props&&props.cluster&&this.zoomToCoordinate(e.lngLat)}))}))}_getSystemColorPreference(){return window.matchMedia("(prefers-color-scheme: dark)").matches}static propDecorators={mapboxToken:[{type:core.Input,args:[{isSignal:!0,alias:"mapboxToken",required:!0,transform:void 0}]}],center:[{type:core.Input,args:[{isSignal:!0,alias:"center",required:!1,transform:void 0}]}],zoom:[{type:core.Input,args:[{isSignal:!0,alias:"zoom",required:!1,transform:void 0}]}],featureCollection:[{type:core.Input,args:[{isSignal:!0,alias:"featureCollection",required:!1,transform:void 0}]}],cluster:[{type:core.Input}],zoomToFit:[{type:core.Input}],borderRadius:[{type:core.Input,args:[{isSignal:!0,alias:"borderRadius",required:!1,transform:void 0}]}],mapReady:[{type:core.Output}],clickedMap:[{type:core.Output}],pannedMap:[{type:core.Output}],panningMap:[{type:core.Output}],clickedFeature:[{type:core.Output}],hoveredFeature:[{type:core.Output}],polygonArea:[{type:core.Output}],polygonWKT:[{type:core.Output}],mapContainer:[{type:core.ViewChild,args:["map"]}],hostBorderRadius:[{type:core.HostBinding,args:["style.border-radius"]}],hostHeight:[{type:core.HostBinding,args:["style.height"]}],hostWidth:[{type:core.HostBinding,args:["style.width"]}]}};MapComponent=(0,tslib_es6.Cg)([(0,core.Component)({selector:"cue-map",imports:[common_module_CBrzkrmd.MD,resized_directive.C,DarkModeDirective],template:'<div\n    #map\n    id="map"\n    cueResized\n    cueDarkMode\n    (darkModeChange)="setDarkMode($event)"\n    (resized)="onParentResize()"\n  ></div>',styles:[map_component_default()]})],MapComponent);var card_component=__webpack_require__("./projects/cue-ui/src/lib/components/card.component.ts");const meta={title:"Map",component:MapComponent,tags:["autodocs"],argTypes:{featureCollection:{control:"object"}},decorators:[(0,dist.moduleMetadata)({imports:[card_component.i]})]},center=[8.4721927,47.4401767],featureCollection=new class GeoJSONFeatureCollection{type="FeatureCollection";id;bbox;properties;features=[]};featureCollection.id="Amberg",featureCollection.features=[{type:"Feature",geometry:{type:"Point",coordinates:center},properties:{name:"Amberg Group AG"}}];const map_stories=meta,Default={render:args=>({props:args,template:`<cue-map \n      style="height: 600px; width: 100%" \n      [zoom]="${args.zoom}" \n      [center]="${JSON.stringify(args.center)}" \n      mapboxToken="${args.mapboxToken}">\n    </cue-map>`}),args:{mapboxToken:"<MAPBOX_TOKEN>",center,zoom:2,featureCollection}},Card={render:args=>({props:{mapboxToken:args.mapboxToken,borderRadius:args.borderRadius,center:args.center,zoom:args.zoom,featureCollection:args.featureCollection},template:'<cue-map \n      style="height: 200px; width: 200px;" \n      [borderRadius]="borderRadius"\n      [zoom]="zoom" \n      [center]="center" \n      [featureCollection]="featureCollection" \n      [mapboxToken]="mapboxToken">\n    </cue-map>'}),args:{mapboxToken:"<MAPBOX_TOKEN>",center,zoom:12,featureCollection,borderRadius:"30px"}},__namedExportsOrder=["Default","Card"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:'{\n  render: (args: any) => ({\n    props: args,\n    template: `<cue-map \n      style="height: 600px; width: 100%" \n      [zoom]="${args.zoom}" \n      [center]="${JSON.stringify(args.center)}" \n      mapboxToken="${args.mapboxToken}">\n    </cue-map>`\n  }),\n  args: {\n    mapboxToken,\n    center,\n    zoom: 2,\n    featureCollection\n  }\n}',...Default.parameters?.docs?.source}}},Card.parameters={...Card.parameters,docs:{...Card.parameters?.docs,source:{originalSource:'{\n  render: (args: any) => ({\n    props: {\n      mapboxToken: args.mapboxToken,\n      borderRadius: args.borderRadius,\n      center: args.center,\n      zoom: args.zoom,\n      featureCollection: args.featureCollection\n    },\n    template: `<cue-map \n      style="height: 200px; width: 200px;" \n      [borderRadius]="borderRadius"\n      [zoom]="zoom" \n      [center]="center" \n      [featureCollection]="featureCollection" \n      [mapboxToken]="mapboxToken">\n    </cue-map>`\n  }),\n  args: {\n    mapboxToken,\n    center,\n    zoom: 12,\n    featureCollection,\n    borderRadius: \'30px\'\n  }\n}',...Card.parameters?.docs?.source}}}},"./projects/cue-ui/src/lib/directives/resized.directive.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{C:()=>ResizedDirective});var tslib__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),_angular_core__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@angular/core/fesm2022/core.mjs");class ResizedEvent{newRect;oldRect;isFirst;constructor(newRect,oldRect){this.newRect=newRect,this.oldRect=oldRect,this.isFirst=null==oldRect}}let ResizedDirective=class ResizedDirective{element;zone;observer;oldRect;resized;constructor(element,zone){this.element=element,this.zone=zone,this.resized=new _angular_core__WEBPACK_IMPORTED_MODULE_0__.EventEmitter,this.observer=new ResizeObserver((entries=>this.zone.run((()=>this.observe(entries)))))}ngOnInit(){this.observer.observe(this.element.nativeElement)}ngOnDestroy(){this.observer.disconnect()}observe(entries){const domSize=entries[0],resizedEvent=new ResizedEvent(domSize.contentRect,this.oldRect);this.oldRect=domSize.contentRect,this.resized.emit(resizedEvent)}static ctorParameters=()=>[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.ElementRef},{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.NgZone}];static propDecorators={resized:[{type:_angular_core__WEBPACK_IMPORTED_MODULE_0__.Output}]}};ResizedDirective=(0,tslib__WEBPACK_IMPORTED_MODULE_1__.Cg)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.Directive)({standalone:!0,selector:"[cueResized]"})],ResizedDirective)}}]);